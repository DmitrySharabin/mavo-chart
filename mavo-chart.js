!function(t,e){const s="canvas.mv-chart, canvas[mv-chart-data]",a=["pie","doughnut","polarArea"],i=()=>`#${Math.random().toString(16).slice(2,8).slice(-6)}`,r=t=>`{${t.replace(/((rgb|hsl)a?\(.+?\))|(#?\w+)/g,t=>`"${t}"`)}}`;Mavo.Plugins.register("chart",{dependencies:["https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js","https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.css"],init:function(){for(element of e(s)){let t=["mv-chart-options"];element.hasAttribute("mv-expressions-ignore")&&element.getAttribute("mv-expressions-ignore").split(",").forEach(e=>{Mavo.pushUnique(t,e.trim())}),element.setAttribute("mv-expressions-ignore",t.join(", "))}}}),Mavo.Elements.register("chart",{default:!0,selector:s,attribute:null,modes:"read",init:function(){this.storage="none";let e=this.element.getAttribute("mv-chart-type");if(e){const t=Mavo.DOMExpression.search(this.element,"mv-chart-type");t&&(t.update(),e=this.element.getAttribute("mv-chart-type")),e=e.trim()}let s=this.element.getAttribute("mv-chart-title-position");if(s){const t=Mavo.DOMExpression.search(this.element,"mv-chart-title-position");t&&(t.update(),s=this.element.getAttribute("mv-chart-title-position")),s=s.trim()}let h=this.element.getAttribute("mv-chart-legend-position");if(h){const t=Mavo.DOMExpression.search(this.element,"mv-chart-legend-position");t&&(t.update(),h=this.element.getAttribute("mv-chart-legend-position")),h=h.trim()}const n={type:e||"line",options:{title:{position:s||"top"},legend:{position:h||"top"}}},l=[];let o=this.element.getAttribute("mv-chart-series-styles");if(o){const t=Mavo.DOMExpression.search(this.element,"mv-chart-series-styles");t&&(t.update(),o=this.element.getAttribute("mv-chart-series-styles")),o.split(";").forEach(t=>l.push(JSON.parse(r(t))))}if(this.chart=new Chart(this.element.getContext("2d"),n),t.extend(this.chart.data.datasets,l),this.element.hasAttribute("mv-chart-data")){const t=(t,e)=>{t.split(";").forEach((t,s)=>{const r=t.split(",").map(t=>+t);if(e.data.datasets[s]={...e.data.datasets[s],data:r},s>=l.length)if(a.includes(e.config.type)){let t;e.data.datasets[s].backgroundColor?t=e.data.datasets[s].backgroundColor.length:(e.data.datasets[s].backgroundColor=[],t=0);for(let a=t;a<r.length;a++)e.data.datasets[s].backgroundColor.push(i())}else{const t=i();e.data.datasets[s]={...e.data.datasets[s],borderColor:t,backgroundColor:`${t}4d`}}})};Mavo.DOMExpression.search(this.element,"mv-chart-data")?this.chartDataObserver=new Mavo.Observer(this.element,"mv-chart-data",()=>{t(this.element.getAttribute("mv-chart-data"),this.chart),this.chart.update()}):t(this.element.getAttribute("mv-chart-data"),this.chart)}if(this.element.hasAttribute("mv-chart-labels")){const t=t=>t.split(",").map(t=>t.replace(/\s{2,}/g," ").trim());Mavo.DOMExpression.search(this.element,"mv-chart-labels")?this.chartLabelsObserver=new Mavo.Observer(this.element,"mv-chart-labels",()=>{this.chart.data.labels=t(this.element.getAttribute("mv-chart-labels")),this.chart.update()}):this.chart.data.labels=t(this.element.getAttribute("mv-chart-labels"))}if(this.element.hasAttribute("mv-chart-title")){const t=(t,e)=>{const s=t.replace(/\s{2,}/g," ").trim();""===s?e.options.title.display=!1:(e.options.title.text=s,e.options.title.display=!0)};Mavo.DOMExpression.search(this.element,"mv-chart-title")?this.chartTitleObserver=new Mavo.Observer(this.element,"mv-chart-title",()=>{t(this.element.getAttribute("mv-chart-title"),this.chart),this.chart.update()}):t(this.element.getAttribute("mv-chart-title"),this.chart)}if(this.element.hasAttribute("mv-chart-legend")){const t=(t,e)=>{const s=t.replace(/\s{2,}/g," ").trim();""===s?e.options.legend.display=!1:(e.options.legend.display=!0,s.split(",").forEach((t,s)=>{e.data.datasets[s]={...e.data.datasets[s],label:t.trim()}}))};Mavo.DOMExpression.search(this.element,"mv-chart-legend")?this.chartLegendObserver=new Mavo.Observer(this.element,"mv-chart-legend",()=>{t(this.element.getAttribute("mv-chart-legend"),this.chart),this.chart.update()}):t(this.element.getAttribute("mv-chart-legend"),this.chart)}else this.chart.options.legend.display=!1;if(this.element.hasAttribute("mv-chart-options")){const e=r(this.element.getAttribute("mv-chart-options"));t.extend(this.chart.options,JSON.parse(e))}}})}(Bliss,Bliss.$);